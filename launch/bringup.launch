<?xml version="1.0"?>
<!--
  Elderly Bot Bringup Launch File
  
  Starts:
  - rosserial connection to ESP32
  - RPLidar node
  - Static TF transforms
  
  This launch file brings up the core hardware interfaces.
-->
<launch>
  <!-- ========== PARAMETERS ========== -->
  
  <!-- Serial port for ESP32 -->
  <arg name="esp32_port" default="/dev/ttyUSB1" />
  <arg name="esp32_baud" default="115200" />
  
  <!-- Serial port for RPLidar -->
  <arg name="lidar_port" default="/dev/ttyUSB0" />
  <arg name="lidar_baud" default="115200" />
  
  <!-- Robot geometry parameters -->
  <param name="robot_description" 
         command="echo 'Elderly Bot - 4WD Indoor Monitoring Robot'" />
  
  <!-- ========== ROSSERIAL NODE (ESP32) ========== -->
  
  <node name="esp32_serial_node" 
        pkg="rosserial_python" 
        type="serial_node.py"
        output="screen"
        respawn="true"
        respawn_delay="5">
    <param name="port" value="$(arg esp32_port)" />
    <param name="baud" value="$(arg esp32_baud)" />
  </node>
  
  <!-- ========== RPLIDAR NODE ========== -->
  
  <node name="rplidar_node" 
        pkg="rplidar_ros" 
        type="rplidarNode"
        output="screen"
        respawn="true"
        respawn_delay="5">
    <param name="serial_port" value="$(arg lidar_port)" />
    <param name="serial_baudrate" value="$(arg lidar_baud)" />
    <param name="frame_id" value="laser" />
    <param name="inverted" value="false" />
    <param name="angle_compensate" value="true" />
    <param name="scan_mode" value="Standard" />
  </node>
  
  <!-- ========== STATIC TRANSFORMS ========== -->
  
  <!-- base_footprint to base_link (base_link is elevated) -->
  <node pkg="tf" 
        type="static_transform_publisher" 
        name="base_footprint_to_base_link"
        args="0 0 0.07 0 0 0 base_footprint base_link 100" />
  
  <!-- base_link to laser (lidar mounted 0.30m above ground, 0.23m above base_link) -->
  <!-- Lidar motor facing backward = 180 degree rotation around Z -->
  <node pkg="tf" 
        type="static_transform_publisher" 
        name="base_link_to_laser"
        args="0 0 0.23 3.14159 0 0 base_link laser 100" />
  
  <!-- base_link to imu_link (IMU mounted flat on robot) -->
  <node pkg="tf" 
        type="static_transform_publisher" 
        name="base_link_to_imu_link"
        args="0 0 0.05 0 0 0 base_link imu_link 100" />
  
  <!-- ========== DIAGNOSTICS ========== -->
  
  <!-- Monitor for sensor data loss -->
  <node name="sensor_monitor" 
        pkg="rostopic" 
        type="rostopic"
        args="hz /scan 5" 
        output="screen" />
  
</launch>


