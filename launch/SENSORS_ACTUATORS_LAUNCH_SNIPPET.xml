<!--
====================================================================================================
LAUNCH SNIPPET FOR SENSORS & ACTUATORS NODE
====================================================================================================

Add this snippet to launch/bringup.launch to enable the sensors and actuators node.

USAGE:
  1. Copy the XML block below into launch/bringup.launch (before the closing </launch> tag)
  2. Launch with: roslaunch elderly_bot bringup.launch sensors_actuators:=true
  3. Or leave sensors_actuators:=false (default) to keep it disabled

The node will run safely even without hardware connected (only warnings, no crashes).
To actually enable features, edit config/sensors_actuators.yaml and set enable_* flags to true.

====================================================================================================
-->

  <!-- ============= SENSORS & ACTUATORS (Gas, Buzzer, Jetson Stats) ============= -->
  <!-- Optional: Enable with sensors_actuators:=true -->
  <arg name="sensors_actuators" default="false" doc="Enable gas sensor, buzzer, and Jetson monitoring"/>
  
  <group if="$(arg sensors_actuators)">
    <!-- Load configuration parameters -->
    <rosparam file="$(find elderly_bot)/config/sensors_actuators.yaml" command="load"/>
    
    <!-- Start sensors & actuators node -->
    <node pkg="elderly_bot" type="sensors_actuators_node.py" name="sensors_actuators_node" output="screen">
      <!-- All parameters loaded from YAML file above -->
      <!-- To override from launch file, add <param> tags here -->
    </node>
    
    <node pkg="roswtf" type="roswtf" name="roswtf_check" if="false">
      <!-- Optional: Add roswtf check for diagnostics (disabled by default) -->
    </node>
  </group>
  <!-- ============================================================================= -->

<!--
====================================================================================================
TESTING INSTRUCTIONS (on Jetson Nano):
====================================================================================================

1. WITHOUT HARDWARE (safe test - only enables stats):
   $ roslaunch elderly_bot bringup.launch sensors_actuators:=true
   
   Expected: Node starts, shows warnings about disabled features, publishes zero values.
   Topics: /jetson_temperature, /jetson_power (if jtop available)

2. WITH HARDWARE CONNECTED:
   a. Install dependencies:
      $ sudo apt install python3-pip
      $ pip3 install jetson-stats Jetson.GPIO adafruit-blinka adafruit-circuitpython-ads1x15
      $ sudo reboot  # Required for jetson-stats
   
   b. Edit config/sensors_actuators.yaml:
      - Set enable_gas_sensor: true (after connecting ADS1115 + MQ-6)
      - Set enable_buzzer: true (after connecting buzzer)
      - Set buzzer_pin: 12 (or your chosen GPIO pin)
   
   c. Test I2C connection:
      $ sudo i2cdetect -y -r 1
      # Should show 0x48 (or your ADS1115 address)
   
   d. Launch:
      $ roslaunch elderly_bot bringup.launch sensors_actuators:=true
   
   e. Monitor topics:
      $ rostopic echo /gas_level
      $ rostopic echo /gas_detected
      $ rostopic echo /jetson_temperature
      $ rostopic echo /jetson_power
   
   f. Test buzzer:
      $ rostopic pub /buzzer_command std_msgs/Bool "data: true"   # ON
      $ rostopic pub /buzzer_command std_msgs/Bool "data: false"  # OFF
      # Note: Auto-shutoff after 5 seconds without command

3. INTEGRATION WITH EXISTING SYSTEM:
   - Node is completely independent, no interference with navigation/SLAM
   - Safe to run alongside all existing nodes
   - No TF frames published, no cmd_vel subscription, no costmap interaction

====================================================================================================
PUBLISHED TOPICS:
====================================================================================================
  /gas_level          (std_msgs/Float32)      - Raw voltage 0-3.3V from MQ-6 sensor
  /gas_detected       (std_msgs/Bool)         - True if gas_level > threshold
  /jetson_temperature (sensor_msgs/Temperature) - Jetson GPU/CPU temperature
  /jetson_power       (std_msgs/Float32)      - Total power consumption in watts

SUBSCRIBED TOPICS:
  /buzzer_command     (std_msgs/Bool)         - True=ON, False=OFF (latched)

====================================================================================================
TROUBLESHOOTING:
====================================================================================================
  "Gas sensor disabled: Required libraries not available"
    → pip3 install adafruit-blinka adafruit-circuitpython-ads1x15
  
  "Gas sensor disabled: Failed to initialize ADS1115"
    → Check I2C wiring and address with: sudo i2cdetect -y -r 1
    → Verify adc_i2c_address parameter matches your hardware
  
  "Buzzer disabled: Jetson.GPIO library not available"
    → pip3 install Jetson.GPIO
    → Ensure user in gpio group: sudo usermod -aG gpio $USER
  
  "Jetson stats disabled: jetson-stats library not available"
    → pip3 install jetson-stats
    → Reboot system (required for jtop)
    → Run jtop in terminal to verify it works
  
  Buzzer not working:
    → Check GPIO pin number is correct (BOARD numbering)
    → Verify buzzer is active type (not passive)
    → Test pin with: echo "12" > /sys/class/gpio/export (replace 12 with your pin)
    → Ensure pin not used by another process

====================================================================================================
-->
