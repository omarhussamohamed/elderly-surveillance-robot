# AWS IoT Core Bridge Configuration for Robot Nano
# ==================================================
# This file contains parameters for connecting robot_nano to AWS IoT Core.
#
# STANDARDIZED CONFIGURATION
# Thing Name: robot_nano (MUST match AWS Console exactly)
# Endpoint: a1k8itxfx77i0w-ats.iot.eu-north-1.amazonaws.com
# Port: 8883 (Standard MQTT over TLS)
# Region: eu-north-1
# Account: 011524750104

# AWS IoT Core Configuration
aws_iot_config:
  # Thing identifier (MUST match AWS IoT Thing name exactly)
  client_id: "robot_nano"
  
  # AWS IoT endpoint (ATS endpoint from AWS Console)
  endpoint: "a1k8itxfx77i0w-ats.iot.eu-north-1.amazonaws.com"
  
  # MQTT port (8883 = standard MQTT over TLS, no ALPN needed)
  port: 8883
  
  # Certificate paths (absolute paths required)
  root_ca: "/home/omar/catkin_ws/src/elderly_bot/aws_certs/AmazonRootCA1.pem"
  device_cert: "/home/omar/catkin_ws/src/elderly_bot/aws_certs/certificate.pem.crt"
  private_key: "/home/omar/catkin_ws/src/elderly_bot/aws_certs/private.pem.key"

# ROS Cloud Bridge Node Configuration
cloud_bridge_node:
  # Enable/disable cloud connectivity
  enable_cloud: true
  
  # AWS IoT parameters (loaded from aws_iot_config)
  aws_endpoint: "a1k8itxfx77i0w-ats.iot.eu-north-1.amazonaws.com"
  client_id: "robot_nano"
  port: 8883
  
  # Certificate paths
  root_ca_path: "/home/omar/catkin_ws/src/elderly_bot/aws_certs/AmazonRootCA1.pem"
  cert_path: "/home/omar/catkin_ws/src/elderly_bot/aws_certs/certificate.pem.crt"
  key_path: "/home/omar/catkin_ws/src/elderly_bot/aws_certs/private.pem.key"
  
  # ===== MQTT TOPICS =====
  # MQTT topics for bidirectional communication
  
  # Topic to publish robot telemetry TO cloud
  mqtt_topic_telemetry: "elderly_bot/telemetry"
  
  # Topic to publish alerts TO cloud
  mqtt_topic_alerts: "elderly_bot/alerts"
  
  # Topic to receive commands FROM cloud
  mqtt_topic_commands: "elderly_bot/commands"
  
  # ===== PUBLISHING RATE =====
  # How often to send sensor data to cloud (Hz)
  publish_rate: 1.0  # 1 Hz = once per second (adjust as needed)
  
  # ===== CONNECTION SETTINGS =====
  # MQTT keepalive interval (seconds)
  keepalive_interval: 30
  
  # ===== SETUP GUIDE =====
  # Step-by-step AWS IoT Core setup:
  #
  # 1. Create AWS Account:
  #    - Go to https://aws.amazon.com/
  #    - Create account or sign in
  #
  # 2. Create IoT Thing:
  #    - AWS IoT Core Console → Manage → All devices → Things
  #    - Click "Create things"
  #    - Choose "Create single thing"
  #    - Name: robot_01 (or your custom client_id)
  #
  # 3. Download Certificates:
  #    - During Thing creation, choose "Auto-generate a new certificate"
  #    - Download ALL 4 files:
  #      * Device certificate (.pem.crt)
  #      * Public key (.pem.key - not used but save it)
  #      * Private key (.pem.key - KEEP SECURE!)
  #      * Root CA certificate (Amazon Root CA 1)
  #    - Click "Activate" certificate
  #    - Attach a policy (next step)
  #
  # 4. Create IoT Policy (if not exists):
  #    - AWS IoT Core Console → Security → Policies
  #    - Create policy with these permissions:
  #      {
  #        "Version": "2012-10-17",
  #        "Statement": [
  #          {
  #            "Effect": "Allow",
  #            "Action": ["iot:Connect"],
  #            "Resource": "arn:aws:iot:REGION:ACCOUNT:client/${iot:Connection.Thing.ThingName}"
  #          },
  #          {
  #            "Effect": "Allow",
  #            "Action": ["iot:Publish", "iot:Receive"],
  #            "Resource": "arn:aws:iot:REGION:ACCOUNT:topic/robot/*"
  #          },
  #          {
  #            "Effect": "Allow",
  #            "Action": ["iot:Subscribe"],
  #            "Resource": "arn:aws:iot:REGION:ACCOUNT:topicfilter/robot/*"
  #          }
  #        ]
  #      }
  #
  # 5. Copy Certificates to Jetson:
  #    - Create folder: mkdir ~/aws_certs
  #    - Copy all .pem files to this folder
  #    - Set permissions: chmod 600 ~/aws_certs/*.pem.key
  #
  # 6. Update This Config File:
  #    - Set aws_endpoint (from AWS IoT Settings)
  #    - Set certificate paths (absolute paths on Jetson)
  #    - Set enable_cloud: true
  #
  # 7. Test Connection:
  #    - Launch: roslaunch elderly_bot bringup.launch enable_cloud:=true
  #    - Check logs: "Connected to AWS IoT Core"
  #    - Monitor in AWS: IoT Core → Test → MQTT test client
  #      Subscribe to: robot/sensors/data
  
  # ===== MESSAGE FORMATS =====
  # Sensor data TO cloud (JSON):
  # {
  #   "timestamp": 1234567890.123,
  #   "robot_id": "robot_01",
  #   "sensors": {
  #     "gas_level": 0.5,
  #     "temperature": 45.2,
  #     "power": 12.5
  #   }
  # }
  #
  # Commands FROM cloud (JSON):
  # Buzzer control:
  # {"command": "buzzer", "value": true}
  #
  # Emergency stop:
  # {"command": "stop", "value": null}
  #
  # Movement (use with caution!):
  # {"command": "move", "value": {"linear": 0.1, "angular": 0.0}}
  
  # ===== TROUBLESHOOTING =====
  # "AWS IoT SDK not available"
  #   → pip3 install AWSIoTPythonSDK
  #
  # "Root CA not found"
  #   → Check file path, ensure absolute path
  #   → Download from: https://www.amazontrust.com/repository/AmazonRootCA1.pem
  #
  # "Connection timeout"
  #   → Check internet connection
  #   → Verify endpoint URL (no typos)
  #   → Check port 8883 not blocked by firewall
  #
  # "Certificate verification failed"
  #   → Ensure certificate is activated in AWS IoT Console
  #   → Verify policy is attached to certificate
  #   → Check certificate and key file permissions
  #
  # "Permission denied"
  #   → Verify IoT policy allows connect/publish/subscribe
  #   → Check Thing name matches client_id
