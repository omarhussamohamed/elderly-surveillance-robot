# GMapping SLAM Configuration
# Optimized for indoor 4WD robot with RPLidar A1

# ========== FRAME IDs ==========
base_frame: base_footprint
map_frame: map
odom_frame: odom

# ========== TRANSFORM ==========
# Time tolerance for TF lookups
transform_publish_period: 0.05

# ========== MAP PARAMETERS ==========
# Map resolution (meters per cell)
# STABILITY FIX: Increased from 2.0 to 3.0 for CPU relief (visualization only, not internal mapping)
map_update_interval: 3.0

# Maximum range of laser (RPLidar A1: ~12m, but use conservative value indoors)
maxRange: 10.0
maxUrange: 9.5

# Minimum range
minRange: 0.15

# Map size and resolution
xmin: -50.0
ymin: -50.0
xmax: 50.0
ymax: 50.0
delta: 0.02  # 2cm resolution for sharper walls (was 0.05)

# ========== LASER PARAMETERS ==========
# Number of beams to skip in each scan (for computational efficiency)
# RPLidar A1 produces ~360 points, skip every other one
throttle_scans: 1

# Laser parameters
sigma: 0.02  # Reduced from 0.05 for tighter scan matching and sharper walls
kernelSize: 1
lstep: 0.05
astep: 0.05
iterations: 5
lsigma: 0.075
ogain: 3.0
lskip: 0

# ========== MOTION MODEL ==========
# Odometry error parameters for skid-steer robot
# These are critical for accurate mapping with wheel slip
# INCREASED from optimistic values to reflect 4WD skid-steer reality

# Linear movement error
srr: 0.05   # Linear -> Linear (was 0.01, increased for wheel slip)
srt: 0.15   # Linear -> Angular (INCREASED for stronger cross-coupling during turns)

# Angular movement error - CRITICAL FOR ROTATION
# Pure rotation on skid-steer has EXTREME slip (all 4 wheels sliding laterally)
str: 0.15   # Angular -> Linear (INCREASED - rotation causes severe lateral slip)
stt: 0.25   # Angular -> Angular (INCREASED 2.5× - rotation odometry extremely unreliable)

# ========== PARTICLE FILTER ==========
# Number of particles in the filter
# STABILITY FIX: Reduced from 1000 to 500 for Jetson Nano CPU performance
# With reduced process noise + improved odometry, 500 particles provide sufficient diversity
particles: 500

# Resampling thresholds
# STABILITY FIX: Reduced from 0.5 to 0.3 to resample less frequently
# Prevents excessive resampling with noisy odometry, maintains particle diversity
resampleThreshold: 0.3

# ========== LIKELIHOOD ==========
# Likelihood sampling parameters
llsamplerange: 0.01
llsamplestep: 0.01
lasamplerange: 0.005
lasamplestep: 0.005

# ========== SCAN MATCHING ==========
# Minimum score for accepting a scan match (balanced for reliable matching)
# STABILITY FIX: Reduced from 100 to 50 to accept plain wall scans (low-feature environments)
# With corrected odometry (midpoint integration + IMU vyaw fusion), false matches are minimal
minimumScore: 50

# Linear and angular search range for scan matching
# STABILITY FIX: Reduced from 0.2m to 0.1m for 2× faster map updates during linear motion
linearUpdate: 0.1    # Minimum linear travel before update (10cm - responsive mapping)
angularUpdate: 0.05  # Minimum angular travel before update (2.9° - frequent rotation updates)

# Temporal update
# STABILITY FIX: Enabled with 1.0 sec as safety fallback for edge cases (slow spin, vibration)
temporalUpdate: 1.0  # Force update every 1 second regardless of distance traveled

# ========== OPTIMIZATION ==========
# Number of iterations for scan matching optimization
# STABILITY FIX: Reduced from 5 to 3 for 40% faster scan matching (sufficient for delta=0.02)
optIterations: 3

# ========== INITIAL POSE ==========
# Initial map size
xmin: -10.0
ymin: -10.0
xmax: 10.0
ymax: 10.0

# ========== OUTPUT ==========
# Occupancy threshold
occ_thresh: 0.25

# Map update interval (redundant declaration - primary is at line 17)
map_update_interval: 3.0


