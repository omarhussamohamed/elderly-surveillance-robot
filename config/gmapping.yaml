# GMapping SLAM Configuration
# Optimized for indoor 4WD robot with RPLidar A1

# ========== FRAME IDs ==========
base_frame: base_footprint
map_frame: map
odom_frame: odom

# ========== TRANSFORM ==========
# Time tolerance for TF lookups
transform_publish_period: 0.05

# ========== MAP PARAMETERS ==========
# Map resolution (meters per cell)
map_update_interval: 2.0

# Maximum range of laser (RPLidar A1: ~12m, but use conservative value indoors)
maxRange: 10.0
maxUrange: 9.5

# Minimum range
minRange: 0.15

# Map size and resolution
xmin: -50.0
ymin: -50.0
xmax: 50.0
ymax: 50.0
delta: 0.02  # 2cm resolution for sharper walls (was 0.05)

# ========== LASER PARAMETERS ==========
# Number of beams to skip in each scan (for computational efficiency)
# RPLidar A1 produces ~360 points, skip every other one
throttle_scans: 1

# Laser parameters
sigma: 0.02  # Reduced from 0.05 for tighter scan matching and sharper walls
kernelSize: 1
lstep: 0.05
astep: 0.05
iterations: 5
lsigma: 0.075
ogain: 3.0
lskip: 0

# ========== MOTION MODEL ==========
# Odometry error parameters for skid-steer robot
# These are critical for accurate mapping with wheel slip
# INCREASED from optimistic values to reflect 4WD skid-steer reality

# Linear movement error
srr: 0.05   # Linear -> Linear (was 0.01, increased for wheel slip)
srt: 0.15   # Linear -> Angular (INCREASED for stronger cross-coupling during turns)

# Angular movement error - CRITICAL FOR ROTATION
# Pure rotation on skid-steer has EXTREME slip (all 4 wheels sliding laterally)
str: 0.15   # Angular -> Linear (INCREASED - rotation causes severe lateral slip)
stt: 0.25   # Angular -> Angular (INCREASED 2.5Ã— - rotation odometry extremely unreliable)

# ========== PARTICLE FILTER ==========
# Number of particles in the filter
# INCREASED to 1000 for better hypothesis diversity during large angular motions
particles: 1000

# Resampling thresholds
resampleThreshold: 0.5

# ========== LIKELIHOOD ==========
# Likelihood sampling parameters
llsamplerange: 0.01
llsamplestep: 0.01
lasamplerange: 0.005
lasamplestep: 0.005

# ========== SCAN MATCHING ==========
# Minimum score for accepting a scan match (balanced for reliable matching)
# INCREASED from 50 to 100 to prevent false loop closures causing map ghosting/wall extensions
minimumScore: 100

# Linear and angular search range for scan matching
linearUpdate: 0.2    # Minimum linear travel before update (meters)
angularUpdate: 0.05  # Minimum angular travel before update (REDUCED from 0.2 for frequent rotation updates)

# Temporal update
temporalUpdate: -1.0  # Disabled (use distance-based updates only)

# ========== OPTIMIZATION ==========
# Number of iterations for scan matching optimization
optIterations: 5

# ========== INITIAL POSE ==========
# Initial map size
xmin: -10.0
ymin: -10.0
xmax: 10.0
ymax: 10.0

# ========== OUTPUT ==========
# Occupancy threshold
occ_thresh: 0.25

# Map update interval
map_update_interval: 2.0


